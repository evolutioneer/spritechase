var myScroll;var SlideUpdaters=SlideUpdaters||{};var DialogScreen=(function(){var d;var q;var j;var o;var i;var k;var f=false;var l=false;var c;var a=5;var h=0;var n=function(){d=$(".data");q=$("#dialog-wrapper .scroller");j=$(".next.button");o=$(".sprite.name span");i=$(".sprite.face");myScroll=new iScroll("dialog-wrapper");$(window).bind("reorient",function(){setTimeout(function(){window.scrollTo(0,1);myScroll.refresh()},100)});$(".dialog.button").live("click",function(r){b($(r.target).attr("value"))});currentSlideId="main-1";b("main-1")};var b=function(w){console.log("changeSlide("+w+")");var u=$(".slide."+w);console.log("$slide: "+u);if(!u.length){console.log("!!! No slide found by id "+w+". Aborting.");return}console.log("$dialogBox.children('.append').length: "+q.children(".append").length);
q.children().remove();f=false;var t=$(".face",u);if(t.length){m(t.attr("value"))}var s=$(".name",u);if(s.length){e(s.attr("value"))}var v=$(".next-button-target",u);if(v.length){k=v.attr("value")}else{k=null}if(SlideUpdaters&&SlideUpdaters[w]){SlideUpdaters[w](u)}var r=$(".append",u);r.each(function(x,y){console.log("... i, elem: "+x+", "+y);if($(y).hasClass("text")){f=true;p();g($('<div class="text" />').appendTo(q),$(y).text())}else{q.append($(y).get(0).cloneNode(true))}})};var g=function(t,v){var u=t.append($('<div class="text-build" />'));var s;var r=0;this.textBuildInterval=setInterval(function(){if(l||r==v.length){clearInterval(this.textBuildInterval);console.log("+++ skipTextBuild: "+l+"; nibbleCursor: "+r+"; text.length: "+v.length);u.text(v);f=false;l=false;p();if(i.hasClass("talking")){i.removeClass("talking")
}}else{s=v.substring(r,++r);u.append(s);h++;if(h==a){h=0;i.toggleClass("talking")}}},50)};var e=function(r){o.text(r)};var m=function(r){console.log("updateFace("+r+")");if(r){i.css("background-image","url(/img/dialog/"+r+".gif)")}};var p=function(){j.unbind("click");if(f){j.removeClass("disabled").bind("click",function(r){l=true})}else{if(k){j.removeClass("disabled").bind("click",function(r){b(k)})}else{j.addClass("disabled")}}};return{init:n}})();$(document).ready(DialogScreen.init);